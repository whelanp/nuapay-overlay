/**
Appends a div to the parent the page is visible in the background, the div contains the emandate page
*/
function displayOverlay(token) {
	
	var url = "https://api.nuapay.com/emandate/web/show="+token; 
		
	var elemDiv = document.createElement('div');
	elemDiv.setAttribute("id", "overlay");
	
	elemDiv.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:10000;vertical-align:middle;text-align:center;';
	document.body.appendChild(elemDiv);

	var iframe = document.createElement('iframe');
	iframe.setAttribute("src", url);
	iframe.style.cssText = 'margin: 25px; max-width: 850px; width: 90%; height: 85%; border: 0;';
	
	elemDiv.appendChild(iframe);
	
	var br = document.createElement('br');
	elemDiv.appendChild(br);
	
	//the following is the nuapay logo
	var logo = document.createElement('img');
	logo.setAttribute("src", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM4AAAAoCAYAAAC2AsVbAAAABmJLR0QA/wD/AP+gvaeTAAARSklEQVR42u2debwU1ZXHv12AIiKFpeMEKleDFmIcQVRKRcFIdNwQ3FFRUUcjYXEdw2dwGVFcIGpUBtARSFRAEcXEJQZjZIlIiOWKQY02CN6UKzY0w6Ig9eaPOgVFz3vdVb08lnnn8+lPd1fV3c/vLPeeeytDAgo8egInAAcBHYAfALsDOwEbgdXAZ8AnwFvAX4BZhsu3VEiBx4XAZGAV4APvA68CjxkuKwIPDJetSqblkM9lo9+ZfC5bV+p5oAWwK7AySltB+R3yuewnFaTfVOd4W1KOE4YLgcfBRR7bCHxmuOSq0e+BRwvDZUOa+snvjOFSV24bATIlOmEYcCvQMkX+cwBXmOI94CHDZXwVgFMfPQ9cZLjkK2S8LsC7wI35XPbOMvMYDgzP57JtEj4/B/hJPpfNVFj3c4DpQJ98LvtCmXkYwtSv5XPZHhWM1e3AjQkezQN3GS6jyxV8gcf1wN3AMcCrSfIIPKYB5wK7AavLLPd1YH+jgfsHBh5fA6MTguYN4EzDJQOcJaAB6AyMCzzWBx5nRqCsIvUBVgYeleqcVvJ9h2k5PxaNkJa6AbuZlvNPCZ9vWaU+aFvwXQ5dId9Hm5bTpoJ8orTPABMa+MwCTGBU4PEJ0KpMnrhevq9LAYAFkXAvEzTDRCm807yem2dIw5PQKqCv4TI38DaBon89z7UAZgQekwyXy2tgXr0eeNhiBlRK8/K57B5lmCx1Bd/bEw2O/R4K3FlhfiMMl/eKmVjA00Bf4GPDxU7KE8JjhwD/LJdOT1opw+X+wKMf0D3w+A/DZVRSEw3oJIpkI3CyUfBA7xSg+UCk3FypVNTwbkXSXBZ4PFojn2RmFfJdDVim5Txeqd+xPZBpOZiW014sg4UC+iFVyNoocX+D4XIa8DjQPvC4P+nYyXMR0F8Xvv1ZCgD0Ar4H7go8Diil7WKAni+XTgTWGdHNwGNvIKmNvNxwORCoq6fBHUqkHRB4XFYDPugceHSv0BS8HfgUON+0nFN3dOCIcBgqf8eI0GxvWk7nMs3VxMwvDHmBCKurU2ZxeWRa1qMxS4HuO+Bf5dJrUV1K1PVJwAL+23B5xXBFMkiGs1NU/PgiqtVKkH5i4NGyyv4OwKAKtc4uscF43rSc1rVkoG2EIg3zG2BcdK3WGjc2TmNEePdKojECb5NpNslw+Z5whrVr4G0y3UqWa7jMAcYDVuAxrRjPiG/eD9CGy88jno00zgBg34Rtnmu4vFuksJ0T5nNPDUy2PlWQwv+IMdOcHdVkEzPtaHHon83nskE+l50NrItNFjQGvSHfHROCLRqbscLE42K+WVInH8NlCLAMODcGxkKQ7g7MkEvd48oiskVHpWjomCppiiE1GIS2gcdOVQDPeGAecJhpOcN2YDMtMnHGxTTreCBjWk7fbU3bBh47A8cDXxou74j2eDItP8XMs+5y6beBhxnnawHIvMg0NFz8uKA3Ao+uQLsU9X+uWpoi8DitBubaAdWQxjJA3wOjTcvpuIOabP2B7/K57Mv5XDZq99jI7G0kbRtNJn2UxBSPm3cxegzYPfA4Mik/Ceg+B/5NLs2L83XgcQdwIPBHw2VSfbMf/VI0cpXYldWiU2tgrrWrNANhmO+Ak6JOjTHWjmKm9Y9pmE3tzueyS4G/AyeZltOihtojoiuFkeckSBaZY+MK8onaMDgtPxkuvwFmAgcFHiMkz0OBG4A1wEn1gdGIqasktLTK/XdUDcZkt2qZMvlc9hVgErCXaTmP7Cj+jrRjk69Qj0CIGPPntQKNmEuTZbzuTjApsB+wn8yE5Qs0x1+BHHBRmQA+hXB275bA4zDgz3L7GOqfOcYA9k9RztptzaxqYGasapI5n8teDnwBXGxazok7iMYxRWh9nM9ll9QjEB6q0A8ttQjcLPB4BrgQ+NRwGVZqSjiubRp4dpwA4dw05r/kXScgiSYrdgVuN1zeakiDNQf2StEhmSqPoVEDvqjayn3MPOsBZIEXTctpDazbzrVPBIj/aqDdG0zLmSnm2j7AspTtvSbw+Kqe6y1EWJ4S82u6JIwaGCSM/kQD98cCNwNDYhMGacDzduBxG/CfwELD5eZiaZrLp4mKmzWLZXbtl8DsfC575HberKEFmqW+yZHx4uNdmc9lr0+Z/6Ul7n8BjDJcHigFGtEexxMuczxWhPm/CjzeBnoGHq0Nl9Vl9MvTApwXt4bE39qUqRGA7gbeBI4wLeea7XhSoLNMoPwhn8tuKOLfPQ8EsZmsNDRAfOdDgK5AF8JYLwdoZbi0M1weiEn7UtpgcAkzLQLY2ApNTCMpD+2I2mZNrZgO+Ik4kfeZlvM7YGkFJtuGKtUpWnD+NgH4MS1nk6+QIJB1AjDQtJxjSbcYvNBwebeK3X8G8I3hhrFpRQD268BjkgBndC2ZbEcETq00DsAa03L6EO4Dmp/PZduXu/GLMCYO03L2zeeySyrwwTrG80tAUUBkDuhVYop9YSTB87nsnK0xmLG4xj8FHseWGN8NhIGfhwceBwLv12qTY5N/k55ZXzAt5wnCQNCH87ls6vAUYdb5hAuQvRty0hPSqVKv1xOU2TfGePNTlHH2NjCRca58EqeTsJom4GwrfkI+l+0vU9M/My3nCYnxSqsppohN/otygCNA6EIYYzg3YZmRr3CvmJxJqBvQ27ScS4BGXcsKPPYSP2kx8EhCfl0PDAcGQhNwtiWNEzHtMcDfgJdMy2mZ1kTM57J58ZNONy1nsMTHpQEvpuVMl0s3lTIZJQrgROCzNLNkpuW0BVaIufZII3d35I+NAiYmNbskUvqqwOMU4MVamGtGExTKA08+l10EjCBcm3g57aSEgO/imKN+WErQTCGcqfpDPpedl0ATRFEAY1O2dSXhluNupuXssTXMNMNNBZp4GwfXysdpAk5lALoVWAT8lPCshbTgWwUcJ5feMC3n7Bioimm854ALgC/FjErjK4wrA+CpQ/crNNEIPA4n3Nv121QMHYbgfAwsAXoHHs2agJOMMo1VkDBVT/nbqkzwzYocfOAp03JeZXP4R7yslqblXGlazhrCfUeacLdtXQkTDdNyfiTaaZ6ANS3ApzQmcAr23YwrM4I+0joDm4CTjNY2FtiEqVYA51WSVz6X/b04+R8RhvfMNS2nzrScxablLDQtZznhBrMxAtCH8rns3iQI/ZH7V8ZMwnL79QlgT9NyujWS8BoAfBttVS6DHizQtGn4ILM1gBNsZeCsLyNNdJjfB2UC6ElhLPK57Ndl1vuTfC7bSUy3acBXAqbOwB4yEXEXsGc+lx2Ucv2otdRtWjmzYgK2X8rfYsdQRf23rEJTLVrULXsRUw7DfA6SbakWWirffy+JsMBLFRT5V8PlyBKNfpswzCJpAzMl8ruEcD98Uupa5VXrxA67/C55kmfSvLa1uqXxUSpxyuMnbVZwYGH85M7ER08lPm2nBv32dTUHgPT7axZvhUmC+O+6auW1rdUtpY9SSfq6SvPaYpuzW/16G1D5+c4F9HGVB+BHKZJsLDMqtomaKPXkwPIqa4g3qlzHNDJnVtOQNlFjAWdZ1TILWfyFKtexZ4pnp1fj8A+l7CbOaKKSwHmvyvbt15Q5O1WoveRNBWnKnpjWJo5AopR9rVL2TKXsBwE7dn2gUvbp1ewjpeyLlLLPLiPd1UrZx5WRrrVSdqeCa22Vsvf9/8r4StnNlLIPrQQ4L1ezQiLxb600DwHAr1IkG1VOWVr7KGXfQbhKfQbhDN4Yrf3okSnASylBWEqLtQZ2LabZGrjXhiJvOShS7t5sPt0/utaZzUfJptK0aTVyqecL+y1J/vFnyqyPQUH4UWE+xfLNCKMmnW0pOR0dY/4PCVeri5FvuPywgfT3k/xM4RWGi1Xu1KVS9kvAIK39JUrZEZii7/7AF1r7s5SyDWAi4WEO3URAtCHc4/I/hGsw30m6GYRbfUdIP58HfCj3BgFrtfYfVcq+hHBvzHNy73y592w99byZMGLgCsK1nQla+/fE7h8hzJAB7tLanyHX3wYU4YznSVr7y5SylxFugssDRwArCU+RmUwYfzdVa/9+Sd+RMLrhh0Brrf2B9dTtTMKg4cGELx57Wmv/ptj9h4HDgGbAlVr7rypltwEe0trvL8/sAkzU2r9AKbstMBLYh/CFZtcABwPnEIYanaC1XxcTDE9IvZ/R2h8l+e1NGDnQlfCsg4e19kfLvaeAkwnXbi4FPMKdsc9IHV/R2h9eTONAuLBWba2T5AVFf6snHYHHVaQ7iPuQCkADYWj/IqXsqcBpBY+0EyaN6FLgQq39/aTfWmntHyyaamRMUx0BdNDaP4RwG/EbsXtxehx4IHZvZH2gEVoPXK21f5TWfiegp1L2WUrZKGW3BJ7S2ne19rsBtyhlt1fKzhDup3lSa//HApro2oNa+5209ldK+fMlbxc4Vin7KOmfVoRbEd7S2h/YgCTeAxiltX+s1v4BwA+UsuPHSw3X2j9Ma78r4cIkWvurgI5K2dGBMUOBmZJ/c2Co1n5frf19pZ98rf0uwCvAsMhiINy81lNr/3Cgs1L2CZJHS+DftfZ7y3hdrpStlLIzWvvnAJ7W/kFa+57kcy9wnuTzcFFTTRjuBsLXBFZlnl8YeDnhecDFtgjPLUwXeEyFcD96AlonUnJZufP9Wvto7S/U2t+FcF/McUrZnzfA5ABvau1HbVpAuMqPmLzxeJa6SGJr7a8DJitlH1VP+euB15WyD1bK3ocwaLQh2gm4SYCCmF8XSl37AkuUskcqZY8kPBDjLK39OjENW8TKjK7tHBMghwLLlbJvk/Srgf6xfviz1v7UGLMWUnPgtljdhrHlOWc3KGW/oJQ9HdhJfAxEQEaCe4jW/uRY/nET+U3CN89BeIDgflLvAwjf03SL1Ps7Yf4oXTxIdAbgiKbaVTRLnMYCbyll3wesLGaqNY+do7s/8KGo9KqAJ/DIEoZoPC1qsZCmiYZpBlwrHZh0j9AUwrD8oJIFt0i6ae1/DyzQ2l8gUqmT1n6p0IsMDb9QapcofxnE9sA3DZR/nZiAi4UBGmLOjUC7yJQE9ozlmRPQPSD1Ws/m8KNMA0KxLlZWjvA9rr8SkG1gy/ClUiuzQUHdrKhuStn9gPVa+6fK/7kiWADmK2VPlcmLWWX09TcipO8VQfC9gCfeZ/E6btH++Dho7c8H9lDK7gEs0drfvaipJoy31nDZG7ipoLBKNc9aw+UU8XcmiE2N2Oq9A4/Z0ti7E4DmC+AeYC/D5aJKQROTnnOUsicAx4it3jMGmgxbBv01q8fUre9/Xin790A3pewhYrb9nzxF4/nCrEdp7b9TRNtlgBtlRq4n8CwwQgb9T4TnlfWI2epRvT8HTlbKPkb8CsRP6Av8VCl7Z639paKF+gkgJ4mvAsmDNocqZQ8AjiR8bcxwAZEGeonp2J9Y9Lfcv5HwpcgjCqR8swZ+Z6K+1tr/WiyPAQLW8Wx+R1OmYEyMWL+vAVwxR20B/HgZ/xWUCBY2Cpgcw+UOw6U54Zur7iQ8Y2qRMO3KMsED8JHhcoXh0la02nWE74JcDPxRnLOF8nlN7ODxwFXidLeWY4V+IU5uVV6HKEzXA3hUytkHaBcbwJfYvKhbB9wWSz5OJHUkseN7XVpo7fcW5tyotd8lludsaWOcfgf8ukR1XxTfySR8OVJnrf1/xCYzOkj9zwcu19pfK0zypUwo9EIiRbT23wduITzRc72k7y5C81Lgdq39JTEh92iCGdrrRAj2AY7W2l8kguEvYlZeG4FYtF1GhMR0kfCfxoTG6oJZ1VExTbKpPlLv42Ry5jLgPq39RTFBO6HAVPsw9r8X4a7Yb2VshhIe0Hm+CLyyHfzE12tFjV1eFdcJliV8rqtS9lyl7AVVKnerpFfKHqSUfXEZ6V5Wyv5AKftfKql7Yy9a/y+h79DpHC2xjAAAAABJRU5ErkJggg==");
	
	elemDiv.appendChild(logo);
	
	
	elemDiv.addEventListener("click",function(){removeOverlay();},false);
}

//removes the emandate overlay from the page.
function removeOverlay() {
	var overlay = document.getElementById('overlay');
	
	if(overlay.parentNode!=null) {
		//remove the node
		overlay.parentNode.removeChild(overlay);		
	}	
}

//listen out for the event from the overlayed emandates application
//the event details if the mandate was signed successfully or not
window.addEventListener("message", receiveMessage, false);

function receiveMessage(event)
{
	var json = JSON.parse(event.data);	
	//deal with the json message if you choose to do so.
	if(json.status===1) {
		console.log("Success");
	}
	else {
		console.log("failure");
	}
	//either way remove the overlay when the flow is completed
	removeOverlay();
}